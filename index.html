<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lluvia de Colores en un Vaso</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Toastify CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <link rel="stylesheet" href="css/styles.css">

    <style>
        /* Solo estilos del bot√≥n de m√∫sica, sin tocar lo dem√°s */
        .music-toggle {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 9999;
            background: rgba(15,23,42,0.9);
            border: 1px solid rgba(226,232,240,0.4);
            border-radius: 999px;
            padding: 0.6rem 1.4rem;
            color: #EDF2F7;
            font-size: 0.95rem;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: .4rem;
            backdrop-filter: blur(6px);
        }

        .music-toggle:hover {
            background: rgba(30,41,59,0.95);
        }
    </style>
</head>

<body class="index">
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="vaso">
                <div class="agua"></div>
            </div>

            <!-- Bot√≥n original -->
            <button class="boton-siguiente" onclick="siguientePagina()">Siguiente p√°gina ‚Üí</button>
        </div>
    </div>
</div>

<!-- üéµ Bot√≥n para reproducir la melod√≠a triste (Tone.js), fijo al final -->
<button class="music-toggle" id="music-toggle" type="button">
    üéµ Reproducir m√∫sica
</button>

<!-- Bootstrap JS Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- SoundJS -->
<script src="https://code.createjs.com/1.0.0/soundjs.min.js"></script>

<!-- Toastify JS -->
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

<!-- Tone.js para la melod√≠a de piano triste -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/tone/15.3.5/Tone.js"></script>

<!-- üéº M√∫sica triste tipo piano con Tone.js -->
<script>
    let isPlaying = false;

    // Tempo un poco m√°s r√°pido y natural
    Tone.Transport.bpm.value = 72;

    // Un poco menos de volumen global para evitar saturaci√≥n
    Tone.getDestination().volume.value = -6;

    // Reverb suave (menos cavernosa)
    const reverb = new Tone.Reverb({
        decay: 4,
        wet: 0.28
    }).toDestination();

    // "Piano" sint√©tico: ataque r√°pido, decay corto, algo brillante
    const piano = new Tone.PolySynth(Tone.Synth, {
        oscillator: { type: "amsine" }, // suave pero con cuerpo
        envelope: {
            attack: 0.01,
            decay: 0.35,
            sustain: 0.25,
            release: 1.6
        }
    }).connect(reverb);

    // Un pel√≠n menos de volumen en el instrumento
    piano.volume.value = -4;

    // Progresi√≥n principal en registro medio-alto (m√°s brillante, menos grave)
    const chords = [
        ["A4", "C5", "E5"],  // Am
        ["F4", "A4", "C5"],  // F
        ["D4", "F4", "A4"],  // Dm
        ["E4", "G4", "B4"]   // Em
    ];

    // Melod√≠a (notas sueltas por encima, m√°s larga y triste)
    const melodyNotes = [
        "E5","C5","A4","C5",  null,
        "E5","D5","B4","G4",  null,
        "A4","C5","E5","C5",  null,
        "D5","C5","B4","G4",  null,
        "E5","F5","E5","D5",  null,
        "C5","B4","A4","E5",  null
    ];

    let chordIndex = 0;

    // Loop de acordes (acompa√±amiento)
    const chordLoop = new Tone.Loop((time) => {
        const chord = chords[chordIndex % chords.length];
        piano.triggerAttackRelease(chord, "2n", time);
        chordIndex++;
    }, "2n");

    // Secuencia de melod√≠a (notas por encima de los acordes)
    const melodySeq = new Tone.Sequence((time, note) => {
        if (note) {
            piano.triggerAttackRelease(note, "8n", time);
        }
    }, melodyNotes, "8n");

    const btn = document.getElementById("music-toggle");

    btn.addEventListener("click", async () => {
        await Tone.start(); // necesario para desbloquear audio en navegadores

        if (!isPlaying) {
            chordIndex = 0;
            chordLoop.start(0);
            melodySeq.start("1m"); // la melod√≠a entra despu√©s de un comp√°s
            Tone.Transport.start();
            isPlaying = true;
            btn.textContent = "‚è∏Ô∏è Pausar m√∫sica";
        } else {
            Tone.Transport.stop();
            chordLoop.stop();
            melodySeq.stop();
            piano.releaseAll();
            isPlaying = false;
            btn.textContent = "üéµ Reproducir m√∫sica"
        }
    });
</script>

<!-- Tu script principal -->
<script src="js/main.js"></script>
</body>
</html>
